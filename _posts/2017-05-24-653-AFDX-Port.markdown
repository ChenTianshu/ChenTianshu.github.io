---  

layout : post  
title : 653系统AFDX多端口驱动挂载  

---  
653系统通过虚分区机制，将AFDX端口与ARINC标准通道绑定在一起，对分区与核心系统虚分区之间的通道的操作，视为对AFDX端口进行操作，调用相应的AFDX驱动。  
当系统中仅设置一组收发AFDX端口时，653系统中注册的驱动结构相对简单。  
当AFDX网络要求节点双向互连时，就至少要为网络节点配置两组收发端口。  
相对的，增加AFDX端口，也必须增加相应数量的虚端口和通道。同样需要修改系统中的注册驱动，对AFDX端口和虚端口通道进行映射。  
在注册驱动的Attach()函数中为不同的AFDX端口分配id值：虚端口在核心系统初始化过程中被创建，每个虚端口被创建时，都会调用Attach()函数，获取端口id值。在Attach(）函数中，根据虚端口名称来进行区分，并为不同的虚端口分配pseudoportId，次id会作为参数传入注册驱动的其他函数中，如Write()、Read()等。在读写操作函数中根据id值，操作对应的AFDX端口驱动，实现AFDX端口和虚端口的映射关系。